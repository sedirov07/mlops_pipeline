# MLOps Project: Автоматизированный ML-пайплайн с мониторингом дрифта

## Описание проекта

Реализован полноценный MLOps-пайплайн для автоматизации жизненного цикла ML-модели: от обучения до мониторинга и автоматического переобучения при обнаружении дрифта данных.

## Архитектура

```
┌──────────────────┐     ┌──────────────────────┐      ┌──────────────────┐
│   Apache Airflow │────▶│   MLflow Server      │◀────│   PyCaret AutoML │
│   (Orchestration)│     │   (Tracking/Registry)│      │   (Training)     │
└────────┬─────────┘     └──────────────────────┘      └──────────────────┘
         │
         ▼
┌────────────────────┐
│   Evidently AI     │
│   (Drift Detection)│
└────────────────────┘
```

## Реализованный функционал

### 1. AutoML с PyCaret
- Автоматический подбор лучшей модели из множества алгоритмов
- Обучение на датасете Iris (классификация)
- Расчет метрик: accuracy, precision, recall, F1-score (macro)

### 2. Трекинг экспериментов (MLflow)
- Логирование всех метрик и параметров
- Версионирование моделей в Model Registry
- Стейджинг моделей: Staging → Production

### 3. Оркестрация (Apache Airflow)
- DAG `mlops_monitoring_pipeline` запускается ежедневно (6:00 UTC)
- Автоматическая проверка дрифта данных
- Условное переобучение при обнаружении дрифта

### 4. Мониторинг дрифта (Evidently)
- Сравнение текущих данных с baseline (reference) распределением
- Генерация HTML-отчетов о дрифте
- Детекция смещения признаков и целевой переменной

### 5. Автоматическое переобучение
При обнаружении дрифта:
1. **Формируется augmented датасет** — объединение baseline данных и новых данных с дрифтом
2. Модель переобучается на расширенных данных для адаптации к изменившемуся распределению
3. Новая модель регистрируется в MLflow как Staging
4. **Сравнение моделей проводится на данных с дрифтом** — Production и Staging модели оцениваются именно на новых данных, чтобы определить, какая лучше справляется с изменившимся распределением
5. При улучшении F1-score — автоматическое продвижение в Production

### 6. Контейнеризация (Docker)
- `docker-compose.yml` для запуска всей инфраструктуры
- Сервисы: Airflow (webserver, scheduler), MLflow, PostgreSQL

## Пайплайн обработки дрифта

```
check_data_drift ─▶ branch_on_drift ─┬─▶ skip_retraining ─▶ pipeline_finished
                                     │
                                     └─▶ train_model ─▶ evaluate_candidate ─▶ promote_if_better ─▶ pipeline_finished
```

**Важно:** При переобучении используется **augmented датасет**:
- Данные с дрифтом искусственно смещены (шум в признаках, изменение баланса классов)
- Объединяем baseline + drifted данные, чтобы модель могла работать как со старым, так и с новым распределением
- Это предотвращает "катастрофическое забывание" старых паттернов

## Структура проекта

```
├── dags/
│   └── mlops_pipeline.py    # Airflow DAG с полным пайплайном
├── src/
│   └── automl.py            # PyCaret AutoML + MLflow интеграция
├── logs/
│   └── evidently_drift_report.html  # Отчеты о дрифте
├── mlflow_db/               # MLflow данные и артефакты моделей
│   └── artifacts/           # Сохраненные модели
├── docker-compose.yml       # Инфраструктура
└── requirements.txt         # Зависимости
```

## Запуск

```bash
# Сборка и запуск контейнеров
docker-compose up -d

# Airflow UI: http://localhost:8080
# MLflow UI: http://localhost:5000
```

## Технологии

- **Python 3.11**
- **PyCaret** — AutoML фреймворк
- **MLflow** — трекинг экспериментов и Model Registry
- **Apache Airflow** — оркестрация пайплайнов
- **Evidently AI** — мониторинг дрифта данных
- **Docker / Docker Compose** — контейнеризация
- **PostgreSQL** — хранение метаданных Airflow

## Автор

Седиров Арсен
Проект выполнен в рамках курса MLOps (3 семестр)
